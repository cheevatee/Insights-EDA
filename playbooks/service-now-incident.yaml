---
- name: Create servicenow Incident
  hosts: localhost
  gather_facts: no
  tasks:
  - name: Create a servicenow incident
    servicenow.itsm.incident:
      instance:
        host: "{{ servicenow-instance }}"
        username: "{{ servicenow-user }}"
        password: "{{ servicenow-password }}"
      state: new
      short_description: "{{ ansible_eda.event.payload.application | upper | default('') }}"
      description: |-
        impact: low
        urgency: low
        Account id: "{{ ansible_eda.event.payload.account_id | default('') }}"
        Affected system: "{{ ansible_eda.event.payload.context.display_name | default('') }}"
        Event type: "{{ ansible_eda.event.payload.event_type | default('') }}"
        Bundle: "{{ ansible_eda.event.payload.bundle | default('') }}"
        Created at: "{{ ansible_eda.event.payload.timestamp | default('') }}"
